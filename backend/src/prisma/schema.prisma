generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String       @id @default(uuid())
  email        String       @unique
  passwordHash String       @map("password_hash")
  name         String?
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")
  expenses     Expense[]
  creditCards  CreditCard[]
  categories   Category[]
  budget       Budget?

  @@map("users")
}

model CreditCard {
  id        String    @id @default(uuid())
  userId    String    @map("user_id")
  name      String
  color     String    // Hex background color (e.g., #FF5733)
  textColor String    @default("#FFFFFF") @map("text_color") // Hex text color for accessibility
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  expenses  Expense[]

  @@index([userId])
  @@map("credit_cards")
}

model Expense {
  id           String      @id @default(uuid())
  userId       String      @map("user_id")
  type         ExpenseType
  amount       Decimal     @db.Decimal(10, 2)
  description  String
  date         DateTime    @db.Date
  creditCardId String?     @map("credit_card_id")
  categoryId   String?     @map("category_id")
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")
  user         User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  creditCard   CreditCard? @relation(fields: [creditCardId], references: [id], onDelete: SetNull)
  category     Category?   @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([date])
  @@index([creditCardId])
  @@index([categoryId])
  @@map("expenses")
}

model Category {
  id        String    @id @default(uuid())
  userId    String    @map("user_id")
  name      String
  color     String    // Hex background color (e.g., #FF5733)
  textColor String    @default("#FFFFFF") @map("text_color") // Hex text color for accessibility
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  expenses  Expense[]
  budgetItems BudgetItem[]

  @@index([userId])
  @@map("categories")
}

model Budget {
  id        String      @id @default(uuid())
  userId    String      @unique @map("user_id")
  createdAt DateTime    @default(now()) @map("created_at")
  updatedAt DateTime    @updatedAt @map("updated_at")
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  items     BudgetItem[]

  @@map("budgets")
}

model BudgetItem {
  id         String    @id @default(uuid())
  budgetId   String    @map("budget_id")
  item       String
  amount     Decimal   @db.Decimal(10, 2)
  categoryId String?   @map("category_id")
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")
  budget     Budget    @relation(fields: [budgetId], references: [id], onDelete: Cascade)
  category   Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  @@index([budgetId])
  @@index([categoryId])
  @@map("budget_items")
}

enum ExpenseType {
  income
  outcome
}
